/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/liquidjs@10.10.0/dist/liquid.browser.esm.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
class Token{constructor(e,t,r,i,s){this.kind=e,this.input=t,this.begin=r,this.end=i,this.file=s}getText(){return this.input.slice(this.begin,this.end)}getPosition(){let[e,t]=[1,1];for(let r=0;r<this.begin;r++)"\n"===this.input[r]?(e++,t=1):t++;return[e,t]}size(){return this.end-this.begin}}class Drop{liquidMethodMissing(e){}}const toString$1=Object.prototype.toString,toLowerCase=String.prototype.toLowerCase,hasOwnProperty=Object.hasOwnProperty;function isString(e){return"string"==typeof e}function isFunction(e){return"function"==typeof e}function isPromise(e){return e&&isFunction(e.then)}function isIterator(e){return e&&isFunction(e.next)&&isFunction(e.throw)&&isFunction(e.return)}function escapeRegex(e){return e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}function stringify(e){return isString(e=toValue(e))?e:isNil(e)?"":isArray(e)?e.map((e=>stringify(e))).join(""):String(e)}function toValue(e){return e instanceof Drop&&isFunction(e.valueOf)?e.valueOf():e}function isNumber(e){return"number"==typeof e}function toLiquid(e){return e&&isFunction(e.toLiquid)?toLiquid(e.toLiquid()):e}function isNil(e){return null==e}function isUndefined(e){return void 0===e}function isArray(e){return"[object Array]"===toString$1.call(e)}function isIterable(e){return isObject(e)&&Symbol.iterator in e}function forOwn(e,t){e=e||{};for(const r in e)if(hasOwnProperty.call(e,r)&&!1===t(e[r],r,e))break;return e}function last(e){return e[e.length-1]}function isObject(e){const t=typeof e;return null!==e&&("object"===t||"function"===t)}function range(e,t,r=1){const i=[];for(let s=e;s<t;s+=r)i.push(s);return i}function padStart(e,t,r=" "){return pad(e,t,r,((e,t)=>t+e))}function padEnd(e,t,r=" "){return pad(e,t,r,((e,t)=>e+t))}function pad(e,t,r,i){let s=t-(e=String(e)).length;for(;s-- >0;)e=i(e,r);return e}function identify(e){return e}function changeCase(e){return[...e].some((e=>e>="a"&&e<="z"))?e.toUpperCase():e.toLowerCase()}function ellipsis(e,t){return e.length>t?e.slice(0,t-3)+"...":e}function caseInsensitiveCompare(e,t){return null==e&&null==t?0:null==e?1:null==t||(e=toLowerCase.call(e))<(t=toLowerCase.call(t))?-1:e>t?1:0}function argumentsToValue(e){return(...t)=>e(...t.map(toValue))}function escapeRegExp(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}const TRAIT="__liquidClass__";class LiquidError extends Error{constructor(e,t){super("string"==typeof e?e:e.message),this.context="","string"!=typeof e&&Object.defineProperty(this,"originalError",{value:e,enumerable:!1}),Object.defineProperty(this,"token",{value:t,enumerable:!1}),Object.defineProperty(this,TRAIT,{value:"LiquidError",enumerable:!1})}update(){Object.defineProperty(this,"context",{value:mkContext(this.token),enumerable:!1}),this.message=mkMessage(this.message,this.token),this.stack=this.message+"\n"+this.context+"\n"+this.stack,this.originalError&&(this.stack+="\nFrom "+this.originalError.stack)}static is(e){return"LiquidError"===(null==e?void 0:e[TRAIT])}}class TokenizationError extends LiquidError{constructor(e,t){super(e,t),this.name="TokenizationError",super.update()}}class ParseError extends LiquidError{constructor(e,t){super(e,t),this.name="ParseError",this.message=e.message,super.update()}}class RenderError extends LiquidError{constructor(e,t){super(e,t.token),this.name="RenderError",this.message=e.message,super.update()}static is(e){return"RenderError"===e.name}}class UndefinedVariableError extends LiquidError{constructor(e,t){super(e,t),this.name="UndefinedVariableError",this.message=e.message,super.update()}}class InternalUndefinedVariableError extends Error{constructor(e){super(`undefined variable: ${e}`),this.name="InternalUndefinedVariableError",this.variableName=e}}class AssertionError extends Error{constructor(e){super(e),this.name="AssertionError",this.message=e+""}}function mkContext(e){const[t,r]=e.getPosition(),i=e.input.split("\n"),s=Math.max(t-2,1),n=Math.min(t+3,i.length);return range(s,n+1).map((e=>{let s=`${e===t?">> ":"   "}${padStart(String(e),String(n).length)}| `;const o=e===t?"\n"+padStart("^",r+s.length):"";return s+=i[e-1],s+=o,s})).join("\n")}function mkMessage(e,t){t.file&&(e+=`, file:${t.file}`);const[r,i]=t.getPosition();return e+=`, line:${r}, col:${i}`}const TYPES=[0,0,0,0,0,0,0,0,0,20,4,4,4,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,20,2,8,0,0,0,0,8,0,0,0,64,0,65,0,0,33,33,33,33,33,33,33,33,33,33,0,0,2,2,2,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],WORD=1,BLANK=4,QUOTE=8,INLINE_BLANK=16,NUMBER=32,SIGN=64,PUNCTUATION=128;function isWord(e){const t=e.charCodeAt(0);return t>=128?!TYPES[t]:!!(TYPES[t]&WORD)}function assert(e,t){if(!e){const r="function"==typeof t?t():t||`expect ${e} to be true`;throw new AssertionError(r)}}TYPES[160]=TYPES[5760]=TYPES[6158]=TYPES[8192]=TYPES[8193]=TYPES[8194]=TYPES[8195]=TYPES[8196]=TYPES[8197]=TYPES[8198]=TYPES[8199]=TYPES[8200]=TYPES[8201]=TYPES[8202]=TYPES[8232]=TYPES[8233]=TYPES[8239]=TYPES[8287]=TYPES[12288]=BLANK,TYPES[8220]=TYPES[8221]=128;class NullDrop extends Drop{equals(e){return isNil(toValue(e))}gt(){return!1}geq(){return!1}lt(){return!1}leq(){return!1}valueOf(){return null}}class EmptyDrop extends Drop{equals(e){return!(e instanceof EmptyDrop)&&(isString(e=toValue(e))||isArray(e)?0===e.length:!!isObject(e)&&0===Object.keys(e).length)}gt(){return!1}geq(){return!1}lt(){return!1}leq(){return!1}valueOf(){return""}}class BlankDrop extends EmptyDrop{equals(e){return!1===e||(!!isNil(toValue(e))||(isString(e)?/^\s*$/.test(e):super.equals(e)))}}class ForloopDrop extends Drop{constructor(e,t,r){super(),this.i=0,this.length=e,this.name=`${r}-${t}`}next(){this.i++}index0(){return this.i}index(){return this.i+1}first(){return 0===this.i}last(){return this.i===this.length-1}rindex(){return this.length-this.i}rindex0(){return this.length-this.i-1}valueOf(){return JSON.stringify(this)}}class BlockDrop extends Drop{constructor(e=(()=>"")){super(),this.superBlockRender=e}super(){return this.superBlockRender()}}function isComparable(e){return e&&isFunction(e.equals)}const nil=new NullDrop,literalValues={true:!0,false:!1,nil:nil,null:nil,empty:new EmptyDrop,blank:new BlankDrop};function createTrie(e){const t={};for(const[r,i]of Object.entries(e)){let e=t;for(let t=0;t<r.length;t++){const i=r[t];e[i]=e[i]||{},t===r.length-1&&isWord(r[t])&&(e[i].needBoundary=!0),e=e[i]}e.data=i,e.end=!0}return t}var __assign=function(){return __assign=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},__assign.apply(this,arguments)};function __awaiter(e,t,r,i){return new(r||(r=Promise))((function(s,n){function o(e){try{l(i.next(e))}catch(e){n(e)}}function a(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))}function toPromise(e){return __awaiter(this,void 0,void 0,(function*(){if(!isIterator(e))return e;let t,r=!1,i="next";do{const s=e[i](t);r=s.done,t=s.value,i="next";try{isIterator(t)&&(t=toPromise(t)),isPromise(t)&&(t=yield t)}catch(e){i="throw",t=e}}while(!r);return t}))}function toValueSync(e){if(!isIterator(e))return e;let t,r=!1,i="next";do{const s=e[i](t);if(r=s.done,t=s.value,i="next",isIterator(t))try{t=toValueSync(t)}catch(e){i="throw",t=e}}while(!r);return t}function toEnumerable(e){return isArray(e=toValue(e))?e:isString(e)&&e.length>0?[e]:isIterable(e)?Array.from(e):isObject(e)?Object.keys(e).map((t=>[t,e[t]])):[]}function toArray(e){return isNil(e)?[]:isArray(e)?e:[e]}const rFormat=/%([-_0^#:]+)?(\d+)?([EO])?(.)/,monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNamesShort=monthNames.map(abbr),dayNamesShort=dayNames.map(abbr);function abbr(e){return e.slice(0,3)}function daysInMonth(e){return[31,isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31]}function getDayOfYear(e){let t=0;for(let r=0;r<e.getMonth();++r)t+=daysInMonth(e)[r];return t+e.getDate()}function getWeekOfYear(e,t){const r=getDayOfYear(e)+(t-e.getDay()),i=7-new Date(e.getFullYear(),0,1).getDay()+t;return String(Math.floor((r-i)/7)+1)}function isLeapYear(e){const t=e.getFullYear();return!(0!=(3&t)||!(t%100||t%400==0&&t))}function getSuffix(e){const t=e.getDate();let r="th";switch(t){case 11:case 12:case 13:break;default:switch(t%10){case 1:r="st";break;case 2:r="nd";break;case 3:r="rd"}}return r}function century(e){return parseInt(e.getFullYear().toString().substring(0,2),10)}const padWidths={d:2,e:2,H:2,I:2,j:3,k:2,l:2,L:3,m:2,M:2,S:2,U:2,W:2},padChars={a:" ",A:" ",b:" ",B:" ",c:" ",e:" ",k:" ",l:" ",p:" ",P:" "},formatCodes={a:e=>dayNamesShort[e.getDay()],A:e=>dayNames[e.getDay()],b:e=>monthNamesShort[e.getMonth()],B:e=>monthNames[e.getMonth()],c:e=>e.toLocaleString(),C:e=>century(e),d:e=>e.getDate(),e:e=>e.getDate(),H:e=>e.getHours(),I:e=>String(e.getHours()%12||12),j:e=>getDayOfYear(e),k:e=>e.getHours(),l:e=>String(e.getHours()%12||12),L:e=>e.getMilliseconds(),m:e=>e.getMonth()+1,M:e=>e.getMinutes(),N:(e,t)=>{const r=Number(t.width)||9;return padEnd(String(e.getMilliseconds()).slice(0,r),r,"0")},p:e=>e.getHours()<12?"AM":"PM",P:e=>e.getHours()<12?"am":"pm",q:e=>getSuffix(e),s:e=>Math.round(e.getTime()/1e3),S:e=>e.getSeconds(),u:e=>e.getDay()||7,U:e=>getWeekOfYear(e,0),w:e=>e.getDay(),W:e=>getWeekOfYear(e,1),x:e=>e.toLocaleDateString(),X:e=>e.toLocaleTimeString(),y:e=>e.getFullYear().toString().slice(2,4),Y:e=>e.getFullYear(),z:(e,t)=>{const r=Math.abs(e.getTimezoneOffset()),i=Math.floor(r/60),s=r%60;return(e.getTimezoneOffset()>0?"-":"+")+padStart(i,2,"0")+(t.flags[":"]?":":"")+padStart(s,2,"0")},t:()=>"\t",n:()=>"\n","%":()=>"%"};function strftime(e,t){let r,i="",s=t;for(;r=rFormat.exec(s);)i+=s.slice(0,r.index),s=s.slice(r.index+r[0].length),i+=format(e,r);return i+s}function format(e,t){const[r,i="",s,n,o]=t,a=formatCodes[o];if(!a)return r;const l={};for(const e of i)l[e]=!0;let u=String(a(e,{flags:l,width:s,modifier:n})),c=padChars[o]||"0",h=s||padWidths[o]||0;return l["^"]?u=u.toUpperCase():l["#"]&&(u=changeCase(u)),l._?c=" ":l[0]&&(c="0"),l["-"]&&(h=0),padStart(u,h,c)}formatCodes.h=formatCodes.b;const OneMinute=6e4,ISO8601_TIMEZONE_PATTERN=/([zZ]|([+-])(\d{2}):(\d{2}))$/;class TimezoneDate{constructor(e,t){this.date=e instanceof TimezoneDate?e.date:new Date(e),this.timezoneOffset=t;const r=6e4*(this.date.getTimezoneOffset()-this.timezoneOffset),i=this.date.getTime()+r;this.displayDate=new Date(i)}getTime(){return this.displayDate.getTime()}getMilliseconds(){return this.displayDate.getMilliseconds()}getSeconds(){return this.displayDate.getSeconds()}getMinutes(){return this.displayDate.getMinutes()}getHours(){return this.displayDate.getHours()}getDay(){return this.displayDate.getDay()}getDate(){return this.displayDate.getDate()}getMonth(){return this.displayDate.getMonth()}getFullYear(){return this.displayDate.getFullYear()}toLocaleString(e,t){return(null==t?void 0:t.timeZone)?this.date.toLocaleString(e,t):this.displayDate.toLocaleString(e,t)}toLocaleTimeString(e){return this.displayDate.toLocaleTimeString(e)}toLocaleDateString(e){return this.displayDate.toLocaleDateString(e)}getTimezoneOffset(){return this.timezoneOffset}static createDateFixedToTimezone(e){const t=e.match(ISO8601_TIMEZONE_PATTERN);if(t&&"Z"===t[1])return new TimezoneDate(+new Date(e),0);if(t&&t[2]&&t[3]&&t[4]){const[,,r,i,s]=t,n=("+"===r?-1:1)*(60*parseInt(i,10)+parseInt(s,10));return new TimezoneDate(+new Date(e),n)}return new Date(e)}}class DelimitedToken extends Token{constructor(e,[t,r],i,s,n,o,a,l){super(e,i,s,n,l),this.trimLeft=!1,this.trimRight=!1;const u="-"===i[t],c="-"===i[r-1];let h=u?t+1:t,p=c?r-1:r;for(;h<p&&TYPES[i.charCodeAt(h)]&BLANK;)h++;for(;p>h&&TYPES[i.charCodeAt(p-1)]&BLANK;)p--;this.contentRange=[h,p],this.trimLeft=u||o,this.trimRight=c||a}get content(){return this.input.slice(this.contentRange[0],this.contentRange[1])}}class TagToken extends DelimitedToken{constructor(e,t,r,i,s){const{trimTagLeft:n,trimTagRight:o,tagDelimiterLeft:a,tagDelimiterRight:l}=i,[u,c]=[t+a.length,r-l.length];super(TokenKind.Tag,[u,c],e,t,r,n,o,s),this.tokenizer=new Tokenizer(e,i.operators,s,this.contentRange),this.name=this.tokenizer.readTagName(),this.tokenizer.assert(this.name,"illegal tag syntax, tag name expected"),this.tokenizer.skipBlank()}get args(){return this.tokenizer.input.slice(this.tokenizer.p,this.contentRange[1])}}class OutputToken extends DelimitedToken{constructor(e,t,r,i,s){const{trimOutputLeft:n,trimOutputRight:o,outputDelimiterLeft:a,outputDelimiterRight:l}=i,u=[t+a.length,r-l.length];super(TokenKind.Output,u,e,t,r,n,o,s)}}class HTMLToken extends Token{constructor(e,t,r,i){super(TokenKind.HTML,e,t,r,i),this.input=e,this.begin=t,this.end=r,this.file=i,this.trimLeft=0,this.trimRight=0}getContent(){return this.input.slice(this.begin+this.trimLeft,this.end-this.trimRight)}}class NumberToken extends Token{constructor(e,t,r,i){super(TokenKind.Number,e,t,r,i),this.input=e,this.begin=t,this.end=r,this.file=i,this.content=Number(this.getText())}}class IdentifierToken extends Token{constructor(e,t,r,i){super(TokenKind.Word,e,t,r,i),this.input=e,this.begin=t,this.end=r,this.file=i,this.content=this.getText()}isNumber(e=!1){for(let t=e&&64&TYPES[this.input.charCodeAt(this.begin)]?this.begin+1:this.begin;t<this.end;t++)if(!(32&TYPES[this.input.charCodeAt(t)]))return!1;return!0}}class LiteralToken extends Token{constructor(e,t,r,i){super(TokenKind.Literal,e,t,r,i),this.input=e,this.begin=t,this.end=r,this.file=i,this.literal=this.getText(),this.content=literalValues[this.literal]}}const operatorPrecedences={"==":2,"!=":2,">":2,"<":2,">=":2,"<=":2,contains:2,not:1,and:0,or:0},operatorTypes={"==":0,"!=":0,">":0,"<":0,">=":0,"<=":0,contains:0,not:1,and:0,or:0};class OperatorToken extends Token{constructor(e,t,r,i){super(TokenKind.Operator,e,t,r,i),this.input=e,this.begin=t,this.end=r,this.file=i,this.operator=this.getText()}getPrecedence(){const e=this.getText();return e in operatorPrecedences?operatorPrecedences[e]:1}}class PropertyAccessToken extends Token{constructor(e,t,r,i,s,n){super(TokenKind.PropertyAccess,r,i,s,n),this.variable=e,this.props=t}}class FilterToken extends Token{constructor(e,t,r,i,s,n){super(TokenKind.Filter,r,i,s,n),this.name=e,this.args=t}}class HashToken extends Token{constructor(e,t,r,i,s,n){super(TokenKind.Hash,e,t,r,n),this.input=e,this.begin=t,this.end=r,this.name=i,this.value=s,this.file=n}}const rHex=/[\da-fA-F]/,rOct=/[0-7]/,escapeChar={b:"\b",f:"\f",n:"\n",r:"\r",t:"\t",v:"\v"};function hexVal(e){const t=e.charCodeAt(0);return t>=97?t-87:t>=65?t-55:t-48}function parseStringLiteral(e){let t="";for(let r=1;r<e.length-1;r++)if("\\"===e[r])if(void 0!==escapeChar[e[r+1]])t+=escapeChar[e[++r]];else if("u"===e[r+1]){let i=0,s=r+2;for(;s<=r+5&&rHex.test(e[s]);)i=16*i+hexVal(e[s++]);r=s-1,t+=String.fromCharCode(i)}else if(rOct.test(e[r+1])){let i=r+1,s=0;for(;i<=r+3&&rOct.test(e[i]);)s=8*s+hexVal(e[i++]);r=i-1,t+=String.fromCharCode(s)}else t+=e[++r];else t+=e[r];return t}class QuotedToken extends Token{constructor(e,t,r,i){super(TokenKind.Quoted,e,t,r,i),this.input=e,this.begin=t,this.end=r,this.file=i,this.content=parseStringLiteral(this.getText())}}class RangeToken extends Token{constructor(e,t,r,i,s,n){super(TokenKind.Range,e,t,r,n),this.input=e,this.begin=t,this.end=r,this.lhs=i,this.rhs=s,this.file=n}}class LiquidTagToken extends DelimitedToken{constructor(e,t,r,i,s){super(TokenKind.Tag,[t,r],e,t,r,!1,!1,s),this.tokenizer=new Tokenizer(e,i.operators,s,this.contentRange),this.name=this.tokenizer.readTagName(),this.tokenizer.assert(this.name,"illegal liquid tag syntax"),this.tokenizer.skipBlank(),this.args=this.tokenizer.remaining()}}class FilteredValueToken extends Token{constructor(e,t,r,i,s,n){super(TokenKind.FilteredValue,r,i,s,n),this.initial=e,this.filters=t,this.input=r,this.begin=i,this.end=s,this.file=n}}class SimpleEmitter{constructor(){this.buffer=""}write(e){this.buffer+=stringify(e)}}class StreamedEmitter{constructor(){throw this.buffer="",this.stream=null,new Error("streaming not supported in browser")}}class KeepingTypeEmitter{constructor(){this.buffer=""}write(e){"string"!=typeof(e=toValue(e))&&""===this.buffer?this.buffer=e:this.buffer=stringify(this.buffer)+stringify(e)}}class Render{renderTemplatesToNodeStream(e,t){const r=new StreamedEmitter;return Promise.resolve().then((()=>toPromise(this.renderTemplates(e,t,r)))).then((()=>r.end()),(e=>r.error(e))),r.stream}*renderTemplates(e,t,r){r||(r=t.opts.keepOutputType?new KeepingTypeEmitter:new SimpleEmitter);for(const i of e)try{const e=yield i.render(t,r);if(e&&r.write(e),r.break||r.continue)break}catch(e){throw RenderError.is(e)?e:new RenderError(e,i)}return r.buffer}}class Expression{constructor(e){this.postfix=[...toPostfix(e)]}*evaluate(e,t){assert(e,"unable to evaluate: context not defined");const r=[];for(const i of this.postfix)if(isOperatorToken(i)){const t=r.pop();let s;if(1===operatorTypes[i.operator])s=yield e.opts.operators[i.operator](t,e);else{const n=r.pop();s=yield e.opts.operators[i.operator](n,t,e)}r.push(s)}else r.push(yield evalToken(i,e,t&&1===this.postfix.length));return r[0]}valid(){return!!this.postfix.length}}function*evalToken(e,t,r=!1){if(e)return"content"in e?e.content:isPropertyAccessToken(e)?yield evalPropertyAccessToken(e,t,r):isRangeToken(e)?yield evalRangeToken(e,t):void 0}function*evalPropertyAccessToken(e,t,r){const i=[],s=yield evalToken(e.variable,t,r);for(const r of e.props)i.push(yield evalToken(r,t,!1));try{return e.variable?yield t._getFromScope(s,i):yield t._get(i)}catch(t){if(r&&"InternalUndefinedVariableError"===t.name)return null;throw new UndefinedVariableError(t,e)}}function evalQuotedToken(e){return e.content}function*evalRangeToken(e,t){return range(+(yield evalToken(e.lhs,t)),+(yield evalToken(e.rhs,t))+1)}function*toPostfix(e){const t=[];for(const r of e)if(isOperatorToken(r)){for(;t.length&&t[t.length-1].getPrecedence()>r.getPrecedence();)yield t.pop();t.push(r)}else yield r;for(;t.length;)yield t.pop()}function isTruthy(e,t){return!isFalsy(e,t)}function isFalsy(e,t){return t.opts.jsTruthy?!e:!1===e||null==e}const defaultOperators={"==":equal,"!=":(e,t)=>!equal(e,t),">":(e,t)=>isComparable(e)?e.gt(t):isComparable(t)?t.lt(e):toValue(e)>toValue(t),"<":(e,t)=>isComparable(e)?e.lt(t):isComparable(t)?t.gt(e):toValue(e)<toValue(t),">=":(e,t)=>isComparable(e)?e.geq(t):isComparable(t)?t.leq(e):toValue(e)>=toValue(t),"<=":(e,t)=>isComparable(e)?e.leq(t):isComparable(t)?t.geq(e):toValue(e)<=toValue(t),contains:(e,t)=>(e=toValue(e),t=toValue(t),!(!e||!isFunction(e.indexOf))&&e.indexOf(t)>-1),not:(e,t)=>isFalsy(toValue(e),t),and:(e,t,r)=>isTruthy(toValue(e),r)&&isTruthy(toValue(t),r),or:(e,t,r)=>isTruthy(toValue(e),r)||isTruthy(toValue(t),r)};function equal(e,t){return isComparable(e)?e.equals(t):isComparable(t)?t.equals(e):(e=toValue(e),t=toValue(t),isArray(e)?isArray(t)&&arrayEqual(e,t):e===t)}function arrayEqual(e,t){return e.length===t.length&&!e.some(((e,r)=>!equal(e,t[r])))}class Node{constructor(e,t,r,i){this.key=e,this.value=t,this.next=r,this.prev=i}}class LRU{constructor(e,t=0){this.limit=e,this.size=t,this.cache={},this.head=new Node("HEAD",null,null,null),this.tail=new Node("TAIL",null,null,null),this.head.next=this.tail,this.tail.prev=this.head}write(e,t){if(this.cache[e])this.cache[e].value=t;else{const r=new Node(e,t,this.head.next,this.head);this.head.next.prev=r,this.head.next=r,this.cache[e]=r,this.size++,this.ensureLimit()}}read(e){if(!this.cache[e])return;const{value:t}=this.cache[e];return this.remove(e),this.write(e,t),t}remove(e){const t=this.cache[e];t.prev.next=t.next,t.next.prev=t.prev,delete this.cache[e],this.size--}clear(){this.head.next=this.tail,this.tail.prev=this.head,this.size=0,this.cache={}}ensureLimit(){this.size>this.limit&&this.remove(this.tail.prev.key)}}function domResolve(e,t){const r=document.createElement("base");r.href=e;const i=document.getElementsByTagName("head")[0];i.insertBefore(r,i.firstChild);const s=document.createElement("a");s.href=t;const n=s.href;return i.removeChild(r),n}function resolve(e,t,r){e.length&&"/"!==last(e)&&(e+="/");return domResolve(e,t).replace(/^(\w+:\/\/[^/]+)(\/[^?]+)/,((e,t,i)=>{const s=i.split("/").pop();return/\.\w+$/.test(s)?e:t+i+r}))}function readFile(e){return __awaiter(this,void 0,void 0,(function*(){return new Promise(((t,r)=>{const i=new XMLHttpRequest;i.onload=()=>{i.status>=200&&i.status<300?t(i.responseText):r(new Error(i.statusText))},i.onerror=()=>{r(new Error("An error occurred whilst receiving the response."))},i.open("GET",e),i.send()}))}))}function readFileSync(e){const t=new XMLHttpRequest;if(t.open("GET",e,!1),t.send(),t.status<200||t.status>=300)throw new Error(t.statusText);return t.responseText}function exists(e){return __awaiter(this,void 0,void 0,(function*(){return!0}))}function existsSync(e){return!0}function dirname(e){return domResolve(e,".")}const sep="/";var fs=Object.freeze({__proto__:null,resolve:resolve,readFile:readFile,readFileSync:readFileSync,exists:exists,existsSync:existsSync,dirname:dirname,sep:"/"});function Default(e,t,...r){return isArray(e=toValue(e))||isString(e)?e.length?e:t:(!1!==e||!new Map(r).get("allow_false"))&&(isFalsy(e,this.context)?t:e)}function json(e,t=0){return JSON.stringify(e,null,t)}const raw={raw:!0,handler:identify},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},unescapeMap={"&amp;":"&","&lt;":"<","&gt;":">","&#34;":'"',"&#39;":"'"};function escape(e){return stringify(e).replace(/&|<|>|"|'/g,(e=>escapeMap[e]))}function unescape(e){return stringify(e).replace(/&(amp|lt|gt|#34|#39);/g,(e=>unescapeMap[e]))}function escape_once(e){return escape(unescape(stringify(e)))}function newline_to_br(e){return stringify(e).replace(/\r?\n/gm,"<br />\n")}function strip_html(e){return stringify(e).replace(/<script[\s\S]*?<\/script>|<style[\s\S]*?<\/style>|<.*?>|<!--[\s\S]*?-->/g,"")}var htmlFilters=Object.freeze({__proto__:null,escape:escape,escape_once:escape_once,newline_to_br:newline_to_br,strip_html:strip_html});const defaultOptions={root:["."],layouts:["."],partials:["."],relativeReference:!0,jekyllInclude:!1,cache:void 0,extname:"",fs:fs,dynamicPartials:!0,jsTruthy:!1,dateFormat:"%A, %B %-e, %Y at %-l:%M %P %z",trimTagRight:!1,trimTagLeft:!1,trimOutputRight:!1,trimOutputLeft:!1,greedy:!0,tagDelimiterLeft:"{%",tagDelimiterRight:"%}",outputDelimiterLeft:"{{",outputDelimiterRight:"}}",preserveTimezones:!1,strictFilters:!1,strictVariables:!1,ownPropertyOnly:!0,lenientIf:!1,globals:{},keepOutputType:!1,operators:defaultOperators};function normalize(e){if(e.hasOwnProperty("root")&&(e.hasOwnProperty("partials")||(e.partials=e.root),e.hasOwnProperty("layouts")||(e.layouts=e.root)),e.hasOwnProperty("cache")){let t;t="number"==typeof e.cache?e.cache>0?new LRU(e.cache):void 0:"object"==typeof e.cache?e.cache:e.cache?new LRU(1024):void 0,e.cache=t}return(e=Object.assign(Object.assign(Object.assign({},defaultOptions),e.jekyllInclude?{dynamicPartials:!1}:{}),e)).fs.dirname&&e.fs.sep||!e.relativeReference||(console.warn("[LiquidJS] `fs.dirname` and `fs.sep` are required for relativeReference, set relativeReference to `false` to suppress this warning"),e.relativeReference=!1),e.root=normalizeDirectoryList(e.root),e.partials=normalizeDirectoryList(e.partials),e.layouts=normalizeDirectoryList(e.layouts),e.outputEscape=e.outputEscape&&getOutputEscapeFunction(e.outputEscape),e}function getOutputEscapeFunction(e){return"escape"===e?escape:"json"===e?json:(assert(isFunction(e),"`outputEscape` need to be of type string or function"),e)}function normalizeDirectoryList(e){let t=[];return isArray(e)&&(t=e),isString(e)&&(t=[e]),t}function whiteSpaceCtrl(e,t){let r=!1;for(let i=0;i<e.length;i++){const s=e[i];isDelimitedToken(s)&&(!r&&s.trimLeft&&trimLeft(e[i-1],t.greedy),isTagToken(s)&&("raw"===s.name?r=!0:"endraw"===s.name&&(r=!1)),!r&&s.trimRight&&trimRight(e[i+1],t.greedy))}}function trimLeft(e,t){if(!e||!isHTMLToken(e))return;const r=t?BLANK:INLINE_BLANK;for(;TYPES[e.input.charCodeAt(e.end-1-e.trimRight)]&r;)e.trimRight++}function trimRight(e,t){if(!e||!isHTMLToken(e))return;const r=t?BLANK:INLINE_BLANK;for(;TYPES[e.input.charCodeAt(e.begin+e.trimLeft)]&r;)e.trimLeft++;"\n"===e.input.charAt(e.begin+e.trimLeft)&&e.trimLeft++}class Tokenizer{constructor(e,t=defaultOptions.operators,r,i){this.input=e,this.file=r,this.range=i,this.rawBeginAt=-1,this.p=i?i[0]:0,this.N=i?i[1]:e.length,this.opTrie=createTrie(t),this.literalTrie=createTrie(literalValues)}readExpression(){return new Expression(this.readExpressionTokens())}*readExpressionTokens(){for(;this.p<this.N;){const e=this.readOperator();if(e){yield e;continue}const t=this.readValue();if(!t)return;yield t}}readOperator(){this.skipBlank();const e=this.matchTrie(this.opTrie);if(-1!==e)return new OperatorToken(this.input,this.p,this.p=e,this.file)}matchTrie(e){let t,r=e,i=this.p;for(;r[this.input[i]]&&i<this.N;)r=r[this.input[i++]],r.end&&(t=r);return t?t.needBoundary&&isWord(this.peek(i-this.p))?-1:i:-1}readFilteredValue(){const e=this.p,t=this.readExpression();this.assert(t.valid(),`invalid value expression: ${this.snapshot()}`);const r=this.readFilters();return new FilteredValueToken(t,r,this.input,e,this.p,this.file)}readFilters(){const e=[];for(;;){const t=this.readFilter();if(!t)return e;e.push(t)}}readFilter(){if(this.skipBlank(),this.end())return null;this.assert("|"===this.peek(),'expected "|" before filter'),this.p++;const e=this.p,t=this.readIdentifier();if(!t.size())return this.assert(this.end(),"expected filter name"),null;const r=[];if(this.skipBlank(),":"===this.peek())do{++this.p;const e=this.readFilterArg();e&&r.push(e),this.skipBlank(),this.assert(this.end()||","===this.peek()||"|"===this.peek(),(()=>`unexpected character ${this.snapshot()}`))}while(","===this.peek());else if("|"!==this.peek()&&!this.end())throw this.error('expected ":" after filter name');return new FilterToken(t.getText(),r,this.input,e,this.p,this.file)}readFilterArg(){const e=this.readValue();if(!e)return;if(this.skipBlank(),":"!==this.peek())return e;++this.p;const t=this.readValue();return[e.getText(),t]}readTopLevelTokens(e=defaultOptions){const t=[];for(;this.p<this.N;){const r=this.readTopLevelToken(e);t.push(r)}return whiteSpaceCtrl(t,e),t}readTopLevelToken(e){const{tagDelimiterLeft:t,outputDelimiterLeft:r}=e;return this.rawBeginAt>-1?this.readEndrawOrRawContent(e):this.match(t)?this.readTagToken(e):this.match(r)?this.readOutputToken(e):this.readHTMLToken([t,r])}readHTMLToken(e){const t=this.p;for(;this.p<this.N&&!e.some((e=>this.match(e)));)++this.p;return new HTMLToken(this.input,t,this.p,this.file)}readTagToken(e=defaultOptions){const{file:t,input:r}=this,i=this.p;if(-1===this.readToDelimiter(e.tagDelimiterRight))throw this.error(`tag ${this.snapshot(i)} not closed`,i);const s=new TagToken(r,i,this.p,e,t);return"raw"===s.name&&(this.rawBeginAt=i),s}readToDelimiter(e,t=!1){for(this.skipBlank();this.p<this.N;)if(t&&8&this.peekType())this.readQuoted();else if(++this.p,this.rmatch(e))return this.p;return-1}readOutputToken(e=defaultOptions){const{file:t,input:r}=this,{outputDelimiterRight:i}=e,s=this.p;if(-1===this.readToDelimiter(i,!0))throw this.error(`output ${this.snapshot(s)} not closed`,s);return new OutputToken(r,s,this.p,e,t)}readEndrawOrRawContent(e){const{tagDelimiterLeft:t,tagDelimiterRight:r}=e,i=this.p;let s=this.readTo(t)-t.length;for(;this.p<this.N;)if("endraw"===this.readIdentifier().getText())for(;this.p<=this.N;){if(this.rmatch(r)){const t=this.p;return i===s?(this.rawBeginAt=-1,new TagToken(this.input,i,t,e,this.file)):(this.p=s,new HTMLToken(this.input,i,s,this.file))}if(this.rmatch(t))break;this.p++}else s=this.readTo(t)-t.length;throw this.error(`raw ${this.snapshot(this.rawBeginAt)} not closed`,i)}readLiquidTagTokens(e=defaultOptions){const t=[];for(;this.p<this.N;){const r=this.readLiquidTagToken(e);r&&t.push(r)}return t}readLiquidTagToken(e){if(this.skipBlank(),this.end())return;const t=this.p;this.readToDelimiter("\n");const r=this.p;return new LiquidTagToken(this.input,t,r,e,this.file)}error(e,t=this.p){return new TokenizationError(e,new IdentifierToken(this.input,t,this.N,this.file))}assert(e,t,r){if(!e)throw this.error("function"==typeof t?t():t,r)}snapshot(e=this.p){return JSON.stringify(ellipsis(this.input.slice(e,this.N),32))}readWord(){return this.readIdentifier()}readIdentifier(){this.skipBlank();const e=this.p;for(;!this.end()&&isWord(this.peek());)++this.p;return new IdentifierToken(this.input,e,this.p,this.file)}readTagName(){return this.skipBlank(),"#"===this.input[this.p]?this.input.slice(this.p,++this.p):this.readIdentifier().getText()}readHashes(e){const t=[];for(;;){const r=this.readHash(e);if(!r)return t;t.push(r)}}readHash(e){this.skipBlank(),","===this.peek()&&++this.p;const t=this.p,r=this.readIdentifier();if(!r.size())return;let i;this.skipBlank();const s=e?"=":":";return this.peek()===s&&(++this.p,i=this.readValue()),new HashToken(this.input,t,this.p,r,i,this.file)}remaining(){return this.input.slice(this.p,this.N)}advance(e=1){this.p+=e}end(){return this.p>=this.N}readTo(e){for(;this.p<this.N;)if(++this.p,this.rmatch(e))return this.p;return-1}readValue(){this.skipBlank();const e=this.p,t=this.readLiteral()||this.readQuoted()||this.readRange()||this.readNumber(),r=[];for(;;)if("["!==this.peek()){if(!t&&!r.length){const e=this.readIdentifier();if(e.size()){r.push(e);continue}}if("."!==this.peek()||"."===this.peek(1))break;{this.p++;const e=this.readIdentifier();if(!e.size())break;r.push(e)}}else{this.p++;const e=this.readValue()||new IdentifierToken(this.input,this.p,this.p,this.file);this.assert(-1!==this.readTo("]"),"[ not closed"),r.push(e)}return r.length?new PropertyAccessToken(t,r,this.input,e,this.p):t}readNumber(){this.skipBlank();let e=!1,t=!1,r=0;for(64&this.peekType()&&r++;this.p+r<=this.N;)if(32&this.peekType(r))t=!0,r++;else{if("."!==this.peek(r)||"."===this.peek(r+1))break;if(e||!t)return;e=!0,r++}if(t&&!isWord(this.peek(r))){const e=new NumberToken(this.input,this.p,this.p+r,this.file);return this.advance(r),e}}readLiteral(){this.skipBlank();const e=this.matchTrie(this.literalTrie);if(-1===e)return;const t=new LiteralToken(this.input,this.p,e,this.file);return this.p=e,t}readRange(){this.skipBlank();const e=this.p;if("("!==this.peek())return;++this.p;const t=this.readValueOrThrow();this.p+=2;const r=this.readValueOrThrow();return++this.p,new RangeToken(this.input,e,this.p,t,r,this.file)}readValueOrThrow(){const e=this.readValue();return this.assert(e,(()=>`unexpected token ${this.snapshot()}, value expected`)),e}readQuoted(){this.skipBlank();const e=this.p;if(!(8&this.peekType()))return;++this.p;let t=!1;for(;this.p<this.N&&(++this.p,this.input[this.p-1]!==this.input[e]||t);)t?t=!1:"\\"===this.input[this.p-1]&&(t=!0);return new QuotedToken(this.input,e,this.p,this.file)}*readFileNameTemplate(e){const{outputDelimiterLeft:t}=e,r=[","," ",t],i=new Set(r);for(;this.p<this.N&&!i.has(this.peek());)yield this.match(t)?this.readOutputToken(e):this.readHTMLToken(r)}match(e){for(let t=0;t<e.length;t++)if(e[t]!==this.input[this.p+t])return!1;return!0}rmatch(e){for(let t=0;t<e.length;t++)if(e[e.length-1-t]!==this.input[this.p-1-t])return!1;return!0}peekType(e=0){return this.p+e>=this.N?0:TYPES[this.input.charCodeAt(this.p+e)]}peek(e=0){return this.p+e>=this.N?"":this.input[this.p+e]}skipBlank(){for(;this.peekType()&BLANK;)++this.p}}class ParseStream{constructor(e,t){this.handlers={},this.stopRequested=!1,this.tokens=e,this.parseToken=t}on(e,t){return this.handlers[e]=t,this}trigger(e,t){const r=this.handlers[e];return!!r&&(r.call(this,t),!0)}start(){let e;for(this.trigger("start");!this.stopRequested&&(e=this.tokens.shift());){if(this.trigger("token",e))continue;if(isTagToken(e)&&this.trigger(`tag:${e.name}`,e))continue;const t=this.parseToken(e,this.tokens);this.trigger("template",t)}return this.stopRequested||this.trigger("end"),this}stop(){return this.stopRequested=!0,this}}class TemplateImpl{constructor(e){this.token=e}}class Tag extends TemplateImpl{constructor(e,t,r){super(e),this.name=e.name,this.liquid=r,this.tokenizer=e.tokenizer}}class Hash{constructor(e,t){this.hash={};const r=new Tokenizer(e,{});for(const e of r.readHashes(t))this.hash[e.name.content]=e.value}*render(e){const t={};for(const r of Object.keys(this.hash))t[r]=void 0===this.hash[r]||(yield evalToken(this.hash[r],e));return t}}function createTagClass(e){return class extends Tag{constructor(t,r,i){super(t,r,i),isFunction(e.parse)&&e.parse.call(this,t,r)}*render(t,r){const i=yield new Hash(this.token.args).render(t);return yield e.render.call(this,t,r,i)}}}function isKeyValuePair(e){return isArray(e)}class Filter{constructor(e,t,r,i){this.name=e,this.handler=isFunction(t)?t:isFunction(null==t?void 0:t.handler)?t.handler:identify,this.raw=!isFunction(t)&&!!(null==t?void 0:t.raw),this.args=r,this.liquid=i}*render(e,t){const r=[];for(const e of this.args)isKeyValuePair(e)?r.push([e[0],yield evalToken(e[1],t)]):r.push(yield evalToken(e,t));return yield this.handler.apply({context:t,liquid:this.liquid},[e,...r])}}class Value{constructor(e,t){this.filters=[];const r="string"==typeof e?new Tokenizer(e,t.options.operators).readFilteredValue():e;this.initial=r.initial,this.filters=r.filters.map((({name:e,args:r})=>new Filter(e,this.getFilter(t,e),r,t)))}*value(e,t){t=t||e.opts.lenientIf&&this.filters.length>0&&"default"===this.filters[0].name;let r=yield this.initial.evaluate(e,t);for(const t of this.filters)r=yield t.render(r,e);return r}getFilter(e,t){const r=e.filters[t];return assert(r||!e.options.strictFilters,(()=>`undefined filter: ${t}`)),r}}class Output extends TemplateImpl{constructor(e,t){var r;super(e);const i=new Tokenizer(e.input,t.options.operators,e.file,e.contentRange);this.value=new Value(i.readFilteredValue(),t);const s=this.value.filters,n=t.options.outputEscape;!(null===(r=s[s.length-1])||void 0===r?void 0:r.raw)&&n&&s.push(new Filter(toString.call(n),n,[],t))}*render(e,t){const r=yield this.value.value(e,!1);t.write(r)}}class HTML extends TemplateImpl{constructor(e){super(e),this.str=e.getContent()}*render(e,t){t.write(this.str)}}var LookupType,TokenKind;!function(e){e.Partials="partials",e.Layouts="layouts",e.Root="root"}(LookupType||(LookupType={}));class Loader{constructor(e){if(this.options=e,e.relativeReference){const t=e.fs.sep;assert(t,"`fs.sep` is required for relative reference");const r=new RegExp(["."+t,".."+t,"./","../"].map((e=>escapeRegex(e))).join("|"));this.shouldLoadRelative=e=>r.test(e)}else this.shouldLoadRelative=e=>!1;this.contains=this.options.fs.contains||(()=>!0)}*lookup(e,t,r,i){const{fs:s}=this.options,n=this.options[t];for(const o of this.candidates(e,n,i,t!==LookupType.Root))if(r?s.existsSync(o):yield s.exists(o))return o;throw this.lookupError(e,n)}*candidates(e,t,r,i){const{fs:s,extname:n}=this.options;if(this.shouldLoadRelative(e)&&r){const o=s.resolve(this.dirname(r),e,n);for(const e of t)if(!i||this.contains(e,o)){yield o;break}}for(const r of t){const t=s.resolve(r,e,n);i&&!this.contains(r,t)||(yield t)}if(void 0!==s.fallback){const t=s.fallback(e);void 0!==t&&(yield t)}}dirname(e){const t=this.options.fs;return assert(t.dirname,"`fs.dirname` is required for relative reference"),t.dirname(e)}lookupError(e,t){const r=new Error("ENOENT");return r.message=`ENOENT: Failed to lookup "${e}" in "${t}"`,r.code="ENOENT",r}}class Parser{constructor(e){this.liquid=e,this.cache=this.liquid.options.cache,this.fs=this.liquid.options.fs,this.parseFile=this.cache?this._parseFileCached:this._parseFile,this.loader=new Loader(this.liquid.options)}parse(e,t){const r=new Tokenizer(e,this.liquid.options.operators,t).readTopLevelTokens(this.liquid.options);return this.parseTokens(r)}parseTokens(e){let t;const r=[];for(;t=e.shift();)r.push(this.parseToken(t,e));return r}parseToken(e,t){try{if(isTagToken(e)){const r=this.liquid.tags[e.name];return assert(r,`tag "${e.name}" not found`),new r(e,t,this.liquid)}return isOutputToken(e)?new Output(e,this.liquid):new HTML(e)}catch(t){if(LiquidError.is(t))throw t;throw new ParseError(t,e)}}parseStream(e){return new ParseStream(e,((e,t)=>this.parseToken(e,t)))}*_parseFileCached(e,t,r=LookupType.Root,i){const s=this.cache,n=this.loader.shouldLoadRelative(e)?i+","+e:r+":"+e,o=yield s.read(n);if(o)return o;const a=this._parseFile(e,t,r,i),l=t?yield a:toPromise(a);s.write(n,l);try{return yield l}catch(e){throw s.remove(n),e}}*_parseFile(e,t,r=LookupType.Root,i){const s=yield this.loader.lookup(e,r,t,i);return this.liquid.parse(t?this.fs.readFileSync(s):yield this.fs.readFile(s),s)}}function isDelimitedToken(e){return!!(getKind(e)&TokenKind.Delimited)}function isOperatorToken(e){return getKind(e)===TokenKind.Operator}function isHTMLToken(e){return getKind(e)===TokenKind.HTML}function isOutputToken(e){return getKind(e)===TokenKind.Output}function isTagToken(e){return getKind(e)===TokenKind.Tag}function isQuotedToken(e){return getKind(e)===TokenKind.Quoted}function isLiteralToken(e){return getKind(e)===TokenKind.Literal}function isNumberToken(e){return getKind(e)===TokenKind.Number}function isPropertyAccessToken(e){return getKind(e)===TokenKind.PropertyAccess}function isWordToken(e){return getKind(e)===TokenKind.Word}function isRangeToken(e){return getKind(e)===TokenKind.Range}function getKind(e){return e?e.kind:-1}!function(e){e[e.Number=1]="Number",e[e.Literal=2]="Literal",e[e.Tag=4]="Tag",e[e.Output=8]="Output",e[e.HTML=16]="HTML",e[e.Filter=32]="Filter",e[e.Hash=64]="Hash",e[e.PropertyAccess=128]="PropertyAccess",e[e.Word=256]="Word",e[e.Range=512]="Range",e[e.Quoted=1024]="Quoted",e[e.Operator=2048]="Operator",e[e.FilteredValue=4096]="FilteredValue",e[e.Delimited=12]="Delimited"}(TokenKind||(TokenKind={}));var BlockMode,typeGuards=Object.freeze({__proto__:null,isDelimitedToken:isDelimitedToken,isOperatorToken:isOperatorToken,isHTMLToken:isHTMLToken,isOutputToken:isOutputToken,isTagToken:isTagToken,isQuotedToken:isQuotedToken,isLiteralToken:isLiteralToken,isNumberToken:isNumberToken,isPropertyAccessToken:isPropertyAccessToken,isWordToken:isWordToken,isRangeToken:isRangeToken});class Context{constructor(e={},t=defaultOptions,r={}){var i,s,n;this.scopes=[{}],this.registers={},this.sync=!!r.sync,this.opts=t,this.globals=null!==(i=r.globals)&&void 0!==i?i:t.globals,this.environments=e,this.strictVariables=null!==(s=r.strictVariables)&&void 0!==s?s:this.opts.strictVariables,this.ownPropertyOnly=null!==(n=r.ownPropertyOnly)&&void 0!==n?n:t.ownPropertyOnly}getRegister(e){return this.registers[e]=this.registers[e]||{}}setRegister(e,t){return this.registers[e]=t}saveRegister(...e){return e.map((e=>[e,this.getRegister(e)]))}restoreRegister(e){return e.forEach((([e,t])=>this.setRegister(e,t)))}getAll(){return[this.globals,this.environments,...this.scopes].reduce(((e,t)=>__assign(e,t)),{})}get(e){return this.getSync(e)}getSync(e){return toValueSync(this._get(e))}*_get(e){const t=this.findScope(e[0]);return yield this._getFromScope(t,e)}getFromScope(e,t){return toValueSync(this._getFromScope(e,t))}*_getFromScope(e,t,r=this.strictVariables){isString(t)&&(t=t.split("."));for(let i=0;i<t.length;i++)if(e=yield readProperty(e,t[i],this.ownPropertyOnly),r&&isUndefined(e))throw new InternalUndefinedVariableError(t.slice(0,i+1).join("."));return e}push(e){return this.scopes.push(e)}pop(){return this.scopes.pop()}bottom(){return this.scopes[0]}findScope(e){for(let t=this.scopes.length-1;t>=0;t--){const r=this.scopes[t];if(e in r)return r}return e in this.environments?this.environments:this.globals}}function readProperty(e,t,r){if(isNil(e=toLiquid(e)))return e;if(isArray(e)&&t<0)return e[e.length+ +t];const i=readJSProperty(e,t,r);return void 0===i&&e instanceof Drop?e.liquidMethodMissing(t):isFunction(i)?i.call(e):"size"===t?readSize(e):"first"===t?readFirst(e):"last"===t?readLast(e):i}function readJSProperty(e,t,r){if(!r||Object.hasOwnProperty.call(e,t)||e instanceof Drop)return e[t]}function readFirst(e){return isArray(e)?e[0]:e.first}function readLast(e){return isArray(e)?e[e.length-1]:e.last}function readSize(e){return e.hasOwnProperty("size")||void 0!==e.size?e.size:isArray(e)||isString(e)?e.length:"object"==typeof e?Object.keys(e).length:void 0}!function(e){e[e.OUTPUT=0]="OUTPUT",e[e.STORE=1]="STORE"}(BlockMode||(BlockMode={}));const abs=argumentsToValue(Math.abs),at_least=argumentsToValue(Math.max),at_most=argumentsToValue(Math.min),ceil=argumentsToValue(Math.ceil),divided_by=argumentsToValue(((e,t,r=!1)=>r?Math.floor(e/t):e/t)),floor=argumentsToValue(Math.floor),minus=argumentsToValue(((e,t)=>e-t)),modulo=argumentsToValue(((e,t)=>e%t)),times=argumentsToValue(((e,t)=>e*t));function round(e,t=0){e=toValue(e),t=toValue(t);const r=Math.pow(10,t);return Math.round(e*r)/r}function plus(e,t){return e=toValue(e),t=toValue(t),Number(e)+Number(t)}var mathFilters=Object.freeze({__proto__:null,abs:abs,at_least:at_least,at_most:at_most,ceil:ceil,divided_by:divided_by,floor:floor,minus:minus,modulo:modulo,times:times,round:round,plus:plus});const url_decode=e=>stringify(e).split("+").map(decodeURIComponent).join(" "),url_encode=e=>stringify(e).split(" ").map(encodeURIComponent).join("+");var urlFilters=Object.freeze({__proto__:null,url_decode:url_decode,url_encode:url_encode});const join=argumentsToValue(((e,t)=>toArray(e).join(void 0===t?" ":t))),last$1=argumentsToValue((e=>isArray(e)?last(e):"")),first=argumentsToValue((e=>isArray(e)?e[0]:"")),reverse=argumentsToValue((e=>[...toArray(e)].reverse()));function*sort(e,t){const r=[];for(const i of toArray(toValue(e)))r.push([i,t?yield this.context._getFromScope(i,stringify(t).split("."),!1):i]);return r.sort(((e,t)=>{const r=e[1],i=t[1];return r<i?-1:r>i?1:0})).map((e=>e[0]))}function sort_natural(e,t){e=toValue(e);const r=stringify(t),i=void 0===t?caseInsensitiveCompare:(e,t)=>caseInsensitiveCompare(e[r],t[r]);return[...toArray(e)].sort(i)}const size=e=>e&&e.length||0;function*map(e,t){const r=[];for(const i of toArray(toValue(e)))r.push(yield this.context._getFromScope(i,stringify(t),!1));return r}function*sum(e,t){let r=0;for(const i of toArray(toValue(e))){const e=Number(t?yield this.context._getFromScope(i,stringify(t),!1):i);r+=Number.isNaN(e)?0:e}return r}function compact(e){return toArray(e=toValue(e)).filter((e=>!isNil(toValue(e))))}function concat(e,t=[]){return e=toValue(e),t=toArray(t).map((e=>toValue(e))),toArray(e).concat(t)}function push(e,t){return concat(e,[t])}function slice(e,t,r=1){return isNil(e=toValue(e))?[]:(isArray(e)||(e=stringify(e)),t=t<0?e.length+t:t,e.slice(t,t+r))}function*where(e,t,r){const i=[];e=toArray(toValue(e));for(const r of e)i.push(yield this.context._getFromScope(r,stringify(t).split("."),!1));return e.filter(((e,t)=>void 0===r?isTruthy(i[t],this.context):isComparable(r)?r.equals(i[t]):i[t]===r))}function uniq(e){e=toValue(e);const t={};return(e||[]).filter((e=>!hasOwnProperty.call(t,String(e))&&(t[String(e)]=!0,!0)))}function sample(e,t=1){if(isNil(e=toValue(e)))return[];isArray(e)||(e=stringify(e));const r=[...e].sort((()=>Math.random()-.5));return 1===t?r[0]:r.slice(0,t)}var arrayFilters=Object.freeze({__proto__:null,join:join,last:last$1,first:first,reverse:reverse,sort:sort,sort_natural:sort_natural,size:size,map:map,sum:sum,compact:compact,concat:concat,push:push,slice:slice,where:where,uniq:uniq,sample:sample});function date(e,t,r){const i=this.context.opts;let s;return e=toValue(e),t=isNil(t=toValue(t))?i.dateFormat:stringify(t),s="now"===e||"today"===e?new Date:isNumber(e)?new Date(1e3*e):isString(e)?/^\d+$/.test(e)?new Date(1e3*+e):i.preserveTimezones?TimezoneDate.createDateFixedToTimezone(e):new Date(e):e,isValidDate(s)?(void 0!==r?s=new TimezoneDate(s,parseTimezoneOffset(s,r)):s instanceof TimezoneDate||void 0===i.timezoneOffset||(s=new TimezoneDate(s,parseTimezoneOffset(s,i.timezoneOffset))),strftime(s,t)):e}function isValidDate(e){return(e instanceof Date||e instanceof TimezoneDate)&&!isNaN(e.getTime())}function parseTimezoneOffset(e,t){if(isNumber(t))return t;const r=new Date(e.toLocaleString("en-US",{timeZone:"UTC"})),i=new Date(e.toLocaleString("en-US",{timeZone:t}));return(r.getTime()-i.getTime())/6e4}var dateFilters=Object.freeze({__proto__:null,date:date});function append(e,t){return assert(2===arguments.length,"append expect 2 arguments"),stringify(e)+stringify(t)}function prepend(e,t){return assert(2===arguments.length,"prepend expect 2 arguments"),stringify(t)+stringify(e)}function lstrip(e,t){return t?(t=escapeRegExp(stringify(t)),stringify(e).replace(new RegExp(`^[${t}]+`,"g"),"")):stringify(e).replace(/^\s+/,"")}function downcase(e){return stringify(e).toLowerCase()}function upcase(e){return stringify(e).toUpperCase()}function remove(e,t){return stringify(e).split(String(t)).join("")}function remove_first(e,t){return stringify(e).replace(String(t),"")}function remove_last(e,t){const r=stringify(e),i=String(t),s=r.lastIndexOf(i);return-1===s?r:r.substring(0,s)+r.substring(s+i.length)}function rstrip(e,t){return t?(t=escapeRegExp(stringify(t)),stringify(e).replace(new RegExp(`[${t}]+$`,"g"),"")):stringify(e).replace(/\s+$/,"")}function split(e,t){const r=stringify(e).split(String(t));for(;r.length&&""===r[r.length-1];)r.pop();return r}function strip(e,t){return t?(t=escapeRegExp(stringify(t)),stringify(e).replace(new RegExp(`^[${t}]+`,"g"),"").replace(new RegExp(`[${t}]+$`,"g"),"")):stringify(e).trim()}function strip_newlines(e){return stringify(e).replace(/\r?\n/gm,"")}function capitalize(e){return(e=stringify(e)).charAt(0).toUpperCase()+e.slice(1).toLowerCase()}function replace(e,t,r){return stringify(e).split(String(t)).join(r)}function replace_first(e,t,r){return stringify(e).replace(String(t),r)}function replace_last(e,t,r){const i=stringify(e),s=String(t),n=i.lastIndexOf(s);if(-1===n)return i;const o=String(r);return i.substring(0,n)+o+i.substring(n+s.length)}function truncate(e,t=50,r="..."){return(e=stringify(e)).length<=t?e:e.substring(0,t-r.length)+r}function truncatewords(e,t=15,r="..."){const i=stringify(e).split(/\s+/);t<=0&&(t=1);let s=i.slice(0,t).join(" ");return i.length>=t&&(s+=r),s}var stringFilters=Object.freeze({__proto__:null,append:append,prepend:prepend,lstrip:lstrip,downcase:downcase,upcase:upcase,remove:remove,remove_first:remove_first,remove_last:remove_last,rstrip:rstrip,split:split,strip:strip,strip_newlines:strip_newlines,capitalize:capitalize,replace:replace,replace_first:replace_first,replace_last:replace_last,truncate:truncate,truncatewords:truncatewords});const filters=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},htmlFilters),mathFilters),urlFilters),arrayFilters),dateFilters),stringFilters),{json:json,raw:raw,default:Default});class AssignTag extends Tag{constructor(e,t,r){super(e,t,r),this.key=this.tokenizer.readIdentifier().content,this.tokenizer.assert(this.key,"expected variable name"),this.tokenizer.skipBlank(),this.tokenizer.assert("="===this.tokenizer.peek(),'expected "="'),this.tokenizer.advance(),this.value=new Value(this.tokenizer.readFilteredValue(),this.liquid)}*render(e){e.bottom()[this.key]=yield this.value.value(e,this.liquid.options.lenientIf)}}const MODIFIERS=["offset","limit","reversed"];class ForTag extends Tag{constructor(e,t,r){super(e,t,r);const i=this.tokenizer.readIdentifier(),s=this.tokenizer.readIdentifier(),n=this.tokenizer.readValue();if(!i.size()||"in"!==s.content||!n)throw new Error(`illegal tag: ${e.getText()}`);let o;this.variable=i.content,this.collection=n,this.hash=new Hash(this.tokenizer.remaining()),this.templates=[],this.elseTemplates=[];const a=this.liquid.parser.parseStream(t).on("start",(()=>o=this.templates)).on("tag:else",(()=>o=this.elseTemplates)).on("tag:endfor",(()=>a.stop())).on("template",(e=>o.push(e))).on("end",(()=>{throw new Error(`tag ${e.getText()} not closed`)}));a.start()}*render(e,t){const r=this.liquid.renderer;let i=toEnumerable(yield evalToken(this.collection,e));if(!i.length)return void(yield r.renderTemplates(this.elseTemplates,e,t));const s="continue-"+this.variable+"-"+this.collection.getText();e.push({continue:e.getRegister(s)});const n=yield this.hash.render(e);e.pop();i=(this.liquid.options.orderedFilterParameters?Object.keys(n).filter((e=>MODIFIERS.includes(e))):MODIFIERS.filter((e=>void 0!==n[e]))).reduce(((e,t)=>"offset"===t?offset(e,n.offset):"limit"===t?limit(e,n.limit):reversed(e)),i),e.setRegister(s,(n.offset||0)+i.length);const o={forloop:new ForloopDrop(i.length,this.collection.getText(),this.variable)};e.push(o);for(const s of i){if(o[this.variable]=s,yield r.renderTemplates(this.templates,e,t),t.break){t.break=!1;break}t.continue=!1,o.forloop.next()}e.pop()}}function reversed(e){return[...e].reverse()}function offset(e,t){return e.slice(t)}function limit(e,t){return e.slice(0,t)}class CaptureTag extends Tag{constructor(e,t,r){for(super(e,t,r),this.templates=[],this.variable=this.readVariableName();t.length;){const e=t.shift();if(isTagToken(e)&&"endcapture"===e.name)return;this.templates.push(r.parser.parseToken(e,t))}throw new Error(`tag ${e.getText()} not closed`)}*render(e){const t=this.liquid.renderer,r=yield t.renderTemplates(this.templates,e);e.bottom()[this.variable]=r}readVariableName(){const e=this.tokenizer.readIdentifier().content;if(e)return e;const t=this.tokenizer.readQuoted();if(t)return evalQuotedToken(t);throw this.tokenizer.error("invalid capture name")}}class CaseTag extends Tag{constructor(e,t,r){super(e,t,r),this.branches=[],this.elseTemplates=[],this.value=new Value(this.tokenizer.readFilteredValue(),this.liquid),this.elseTemplates=[];let i=[];const s=this.liquid.parser.parseStream(t).on("tag:when",(e=>{i=[];const t=[];for(;!e.tokenizer.end();)t.push(e.tokenizer.readValueOrThrow()),e.tokenizer.skipBlank(),","===e.tokenizer.peek()?e.tokenizer.readTo(","):e.tokenizer.readTo("or");this.branches.push({values:t,templates:i})})).on("tag:else",(()=>i=this.elseTemplates)).on("tag:endcase",(()=>s.stop())).on("template",(e=>i.push(e))).on("end",(()=>{throw new Error(`tag ${e.getText()} not closed`)}));s.start()}*render(e,t){const r=this.liquid.renderer,i=toValue(yield this.value.value(e,e.opts.lenientIf));let s=!1;for(const n of this.branches)for(const o of n.values){if(i===(yield evalToken(o,e,e.opts.lenientIf))){yield r.renderTemplates(n.templates,e,t),s=!0;break}}s||(yield r.renderTemplates(this.elseTemplates,e,t))}}class CommentTag extends Tag{constructor(e,t,r){for(super(e,t,r);t.length;){const e=t.shift();if(isTagToken(e)&&"endcomment"===e.name)return}throw new Error(`tag ${e.getText()} not closed`)}render(){}}class RenderTag extends Tag{constructor(e,t,r){super(e,t,r);const i=this.tokenizer;for(this.file=parseFilePath(i,this.liquid),this.currentFile=e.file;!i.end();){i.skipBlank();const e=i.p,t=i.readIdentifier();if(("with"===t.content||"for"===t.content)&&(i.skipBlank(),":"!==i.peek())){const e=i.readValue();if(e){const r=i.p;let s;"as"===i.readIdentifier().content?s=i.readIdentifier():i.p=r,this[t.content]={value:e,alias:s&&s.content},i.skipBlank(),","===i.peek()&&i.advance();continue}}i.p=e;break}this.hash=new Hash(i.remaining())}*render(e,t){const{liquid:r,hash:i}=this,s=yield renderFilePath(this.file,e,r);assert(s,(()=>`illegal file path "${s}"`));const n=new Context({},e.opts,{sync:e.sync,globals:e.globals,strictVariables:e.strictVariables}),o=n.bottom();if(__assign(o,yield i.render(e)),this.with){const{value:t,alias:r}=this.with;o[r||s]=yield evalToken(t,e)}if(this.for){const{value:i,alias:a}=this.for,l=toEnumerable(yield evalToken(i,e));o.forloop=new ForloopDrop(l.length,i.getText(),a);for(const e of l){o[a]=e;const i=yield r._parsePartialFile(s,n.sync,this.currentFile);yield r.renderer.renderTemplates(i,n,t),o.forloop.next()}}else{const e=yield r._parsePartialFile(s,n.sync,this.currentFile);yield r.renderer.renderTemplates(e,n,t)}}}function parseFilePath(e,t){if(t.options.dynamicPartials){const r=e.readValue();if(e.assert(r,"illegal file path"),"none"===r.getText())return;if(isQuotedToken(r)){return optimize(t.parse(evalQuotedToken(r)))}return r}const r=[...e.readFileNameTemplate(t.options)],i=optimize(t.parser.parseTokens(r));return"none"===i?void 0:i}function optimize(e){return 1===e.length&&isHTMLToken(e[0].token)?e[0].token.getContent():e}function*renderFilePath(e,t,r){return"string"==typeof e?e:Array.isArray(e)?r.renderer.renderTemplates(e,t):yield evalToken(e,t)}class IncludeTag extends Tag{constructor(e,t,r){super(e,t,r);const{tokenizer:i}=e;this.file=parseFilePath(i,this.liquid),this.currentFile=e.file;const s=i.p;"with"===i.readIdentifier().content?(i.skipBlank(),":"!==i.peek()?this.withVar=i.readValue():i.p=s):i.p=s,this.hash=new Hash(i.remaining(),this.liquid.options.jekyllInclude)}*render(e,t){const{liquid:r,hash:i,withVar:s}=this,{renderer:n}=r,o=yield renderFilePath(this.file,e,r);assert(o,(()=>`illegal file path "${o}"`));const a=e.saveRegister("blocks","blockMode");e.setRegister("blocks",{}),e.setRegister("blockMode",BlockMode.OUTPUT);const l=yield i.render(e);s&&(l[o]=yield evalToken(s,e));const u=yield r._parsePartialFile(o,e.sync,this.currentFile);e.push(e.opts.jekyllInclude?{include:l}:l),yield n.renderTemplates(u,e,t),e.pop(),e.restoreRegister(a)}}class DecrementTag extends Tag{constructor(e,t,r){super(e,t,r),this.variable=this.tokenizer.readIdentifier().content}render(e,t){const r=e.environments;isNumber(r[this.variable])||(r[this.variable]=0),t.write(stringify(--r[this.variable]))}}class CycleTag extends Tag{constructor(e,t,r){super(e,t,r),this.candidates=[];const i=this.tokenizer.readValue();for(this.tokenizer.skipBlank(),i&&(":"===this.tokenizer.peek()?(this.group=i,this.tokenizer.advance()):this.candidates.push(i));!this.tokenizer.end();){const e=this.tokenizer.readValue();e&&this.candidates.push(e),this.tokenizer.readTo(",")}this.tokenizer.assert(this.candidates.length,(()=>`empty candidates: "${e.getText()}"`))}*render(e,t){const r=`cycle:${yield evalToken(this.group,e)}:`+this.candidates.join(","),i=e.getRegister("cycle");let s=i[r];void 0===s&&(s=i[r]=0);const n=this.candidates[s];return s=(s+1)%this.candidates.length,i[r]=s,yield evalToken(n,e)}}class IfTag extends Tag{constructor(e,t,r){let i;super(e,t,r),this.branches=[],this.elseTemplates=[],r.parser.parseStream(t).on("start",(()=>this.branches.push({value:new Value(e.args,this.liquid),templates:i=[]}))).on("tag:elsif",(e=>this.branches.push({value:new Value(e.args,this.liquid),templates:i=[]}))).on("tag:else",(()=>i=this.elseTemplates)).on("tag:endif",(function(){this.stop()})).on("template",(e=>i.push(e))).on("end",(()=>{throw new Error(`tag ${e.getText()} not closed`)})).start()}*render(e,t){const r=this.liquid.renderer;for(const{value:i,templates:s}of this.branches){if(isTruthy(yield i.value(e,e.opts.lenientIf),e))return void(yield r.renderTemplates(s,e,t))}yield r.renderTemplates(this.elseTemplates,e,t)}}class IncrementTag extends Tag{constructor(e,t,r){super(e,t,r),this.variable=this.tokenizer.readIdentifier().content}render(e,t){const r=e.environments;isNumber(r[this.variable])||(r[this.variable]=0);const i=r[this.variable];r[this.variable]++,t.write(stringify(i))}}class LayoutTag extends Tag{constructor(e,t,r){super(e,t,r),this.file=parseFilePath(this.tokenizer,this.liquid),this.currentFile=e.file,this.args=new Hash(this.tokenizer.remaining()),this.templates=this.liquid.parser.parseTokens(t)}*render(e,t){const{liquid:r,args:i,file:s}=this,{renderer:n}=r;if(void 0===s)return e.setRegister("blockMode",BlockMode.OUTPUT),void(yield n.renderTemplates(this.templates,e,t));const o=yield renderFilePath(this.file,e,r);assert(o,(()=>`illegal file path "${o}"`));const a=yield r._parseLayoutFile(o,e.sync,this.currentFile);e.setRegister("blockMode",BlockMode.STORE);const l=yield n.renderTemplates(this.templates,e),u=e.getRegister("blocks");void 0===u[""]&&(u[""]=(e,t)=>t.write(l)),e.setRegister("blockMode",BlockMode.OUTPUT),e.push(yield i.render(e)),yield n.renderTemplates(a,e,t),e.pop()}}class BlockTag extends Tag{constructor(e,t,r){super(e,t,r),this.templates=[];const i=/\w+/.exec(e.args);for(this.block=i?i[0]:"";t.length;){const e=t.shift();if(isTagToken(e)&&"endblock"===e.name)return;const i=r.parser.parseToken(e,t);this.templates.push(i)}throw new Error(`tag ${e.getText()} not closed`)}*render(e,t){const r=this.getBlockRender(e);e.getRegister("blockMode")===BlockMode.STORE?e.getRegister("blocks")[this.block]=r:yield r(new BlockDrop,t)}getBlockRender(e){const{liquid:t,templates:r}=this,i=e.getRegister("blocks")[this.block],s=function*(i,s){e.push({block:i}),yield t.renderer.renderTemplates(r,e,s),e.pop()};return i?(e,t)=>i(new BlockDrop((()=>s(e,t))),t):s}}class RawTag extends Tag{constructor(e,t,r){for(super(e,t,r),this.tokens=[];t.length;){const e=t.shift();if(isTagToken(e)&&"endraw"===e.name)return;this.tokens.push(e)}throw new Error(`tag ${e.getText()} not closed`)}render(){return this.tokens.map((e=>e.getText())).join("")}}class TablerowloopDrop extends ForloopDrop{constructor(e,t,r,i){super(e,r,i),this.length=e,this.cols=t}row(){return Math.floor(this.i/this.cols)+1}col0(){return this.i%this.cols}col(){return this.col0()+1}col_first(){return 0===this.col0()}col_last(){return this.col()===this.cols}}class TablerowTag extends Tag{constructor(e,t,r){super(e,t,r);const i=this.tokenizer.readIdentifier();this.tokenizer.skipBlank();const s=this.tokenizer.readIdentifier(),n=this.tokenizer.readValue();if("in"!==s.content||!n)throw new Error(`illegal tag: ${e.getText()}`);let o;this.variable=i.content,this.collection=n,this.args=new Hash(this.tokenizer.remaining()),this.templates=[];const a=this.liquid.parser.parseStream(t).on("start",(()=>o=this.templates)).on("tag:endtablerow",(()=>a.stop())).on("template",(e=>o.push(e))).on("end",(()=>{throw new Error(`tag ${e.getText()} not closed`)}));a.start()}*render(e,t){let r=toEnumerable(yield evalToken(this.collection,e));const i=yield this.args.render(e),s=i.offset||0,n=void 0===i.limit?r.length:i.limit;r=r.slice(s,s+n);const o=i.cols||r.length,a=this.liquid.renderer,l=new TablerowloopDrop(r.length,o,this.collection.getText(),this.variable),u={tablerowloop:l};e.push(u);for(let i=0;i<r.length;i++,l.next())u[this.variable]=r[i],0===l.col0()&&(1!==l.row()&&t.write("</tr>"),t.write(`<tr class="row${l.row()}">`)),t.write(`<td class="col${l.col()}">`),yield a.renderTemplates(this.templates,e,t),t.write("</td>");r.length&&t.write("</tr>"),e.pop()}}class UnlessTag extends Tag{constructor(e,t,r){let i;super(e,t,r),this.branches=[],this.elseTemplates=[],this.liquid.parser.parseStream(t).on("start",(()=>this.branches.push({value:new Value(e.args,this.liquid),test:isFalsy,templates:i=[]}))).on("tag:elsif",(e=>this.branches.push({value:new Value(e.args,this.liquid),test:isTruthy,templates:i=[]}))).on("tag:else",(()=>i=this.elseTemplates)).on("tag:endunless",(function(){this.stop()})).on("template",(e=>i.push(e))).on("end",(()=>{throw new Error(`tag ${e.getText()} not closed`)})).start()}*render(e,t){const r=this.liquid.renderer;for(const{value:i,test:s,templates:n}of this.branches){if(s(yield i.value(e,e.opts.lenientIf),e))return void(yield r.renderTemplates(n,e,t))}yield r.renderTemplates(this.elseTemplates,e,t)}}class BreakTag extends Tag{render(e,t){t.break=!0}}class ContinueTag extends Tag{render(e,t){t.continue=!0}}class EchoTag extends Tag{constructor(e,t,r){super(e,t,r),this.tokenizer.skipBlank(),this.tokenizer.end()||(this.value=new Value(this.tokenizer.readFilteredValue(),this.liquid))}*render(e,t){if(!this.value)return;const r=yield this.value.value(e,!1);t.write(r)}}class LiquidTag extends Tag{constructor(e,t,r){super(e,t,r);const i=this.tokenizer.readLiquidTagTokens(this.liquid.options);this.templates=this.liquid.parser.parseTokens(i)}*render(e,t){yield this.liquid.renderer.renderTemplates(this.templates,e,t)}}class InlineCommentTag extends Tag{constructor(e,t,r){if(super(e,t,r),-1!==e.args.search(/\n\s*[^#\s]/g))throw new Error("every line of an inline comment must start with a '#' character")}render(){}}const tags={assign:AssignTag,for:ForTag,capture:CaptureTag,case:CaseTag,comment:CommentTag,include:IncludeTag,render:RenderTag,decrement:DecrementTag,increment:IncrementTag,cycle:CycleTag,if:IfTag,layout:LayoutTag,block:BlockTag,raw:RawTag,tablerow:TablerowTag,unless:UnlessTag,break:BreakTag,continue:ContinueTag,echo:EchoTag,liquid:LiquidTag,"#":InlineCommentTag};class Liquid{constructor(e={}){this.renderer=new Render,this.filters={},this.tags={},this.options=normalize(e),this.parser=new Parser(this),forOwn(tags,((e,t)=>this.registerTag(t,e))),forOwn(filters,((e,t)=>this.registerFilter(t,e)))}parse(e,t){return this.parser.parse(e,t)}_render(e,t,r){const i=t instanceof Context?t:new Context(t,this.options,r);return this.renderer.renderTemplates(e,i)}render(e,t,r){return __awaiter(this,void 0,void 0,(function*(){return toPromise(this._render(e,t,Object.assign(Object.assign({},r),{sync:!1})))}))}renderSync(e,t,r){return toValueSync(this._render(e,t,Object.assign(Object.assign({},r),{sync:!0})))}renderToNodeStream(e,t,r={}){const i=new Context(t,this.options,r);return this.renderer.renderTemplatesToNodeStream(e,i)}_parseAndRender(e,t,r){const i=this.parse(e);return this._render(i,t,r)}parseAndRender(e,t,r){return __awaiter(this,void 0,void 0,(function*(){return toPromise(this._parseAndRender(e,t,Object.assign(Object.assign({},r),{sync:!1})))}))}parseAndRenderSync(e,t,r){return toValueSync(this._parseAndRender(e,t,Object.assign(Object.assign({},r),{sync:!0})))}_parsePartialFile(e,t,r){return this.parser.parseFile(e,t,LookupType.Partials,r)}_parseLayoutFile(e,t,r){return this.parser.parseFile(e,t,LookupType.Layouts,r)}_parseFile(e,t,r,i){return this.parser.parseFile(e,t,r,i)}parseFile(e,t){return __awaiter(this,void 0,void 0,(function*(){return toPromise(this.parser.parseFile(e,!1,t))}))}parseFileSync(e,t){return toValueSync(this.parser.parseFile(e,!0,t))}*_renderFile(e,t,r){const i=yield this._parseFile(e,r.sync,r.lookupType);return yield this._render(i,t,r)}renderFile(e,t,r){return __awaiter(this,void 0,void 0,(function*(){return toPromise(this._renderFile(e,t,Object.assign(Object.assign({},r),{sync:!1})))}))}renderFileSync(e,t,r){return toValueSync(this._renderFile(e,t,Object.assign(Object.assign({},r),{sync:!0})))}renderFileToNodeStream(e,t,r){return __awaiter(this,void 0,void 0,(function*(){const i=yield this.parseFile(e);return this.renderToNodeStream(i,t,r)}))}_evalValue(e,t){const r=new Value(e,this),i=t instanceof Context?t:new Context(t,this.options);return r.value(i)}evalValue(e,t){return __awaiter(this,void 0,void 0,(function*(){return toPromise(this._evalValue(e,t))}))}evalValueSync(e,t){return toValueSync(this._evalValue(e,t))}registerFilter(e,t){this.filters[e]=t}registerTag(e,t){this.tags[e]=isFunction(t)?t:createTagClass(t)}plugin(e){return e.call(this,Liquid)}express(){const e=this;let t=!0;return function(r,i,s){if(t){t=!1;const r=normalizeDirectoryList(this.root);e.options.root.unshift(...r),e.options.layouts.unshift(...r),e.options.partials.unshift(...r)}e.renderFile(r,i).then((e=>s(null,e)),s)}}}const version="10.10.0";export{AssertionError,AssignTag,BlockTag,BreakTag,CaptureTag,CaseTag,CommentTag,Context,ContinueTag,CycleTag,DecrementTag,Drop,EchoTag,Expression,Filter,ForTag,Hash,IfTag,IncludeTag,IncrementTag,InlineCommentTag,LayoutTag,Liquid,LiquidError,LiquidTag,Output,ParseError,ParseStream,RawTag,RenderError,RenderTag,TablerowTag,Tag,TagToken,TimezoneDate,Token,TokenKind,TokenizationError,Tokenizer,typeGuards as TypeGuards,UndefinedVariableError,UnlessTag,Value,assert,createTrie,defaultOperators,defaultOptions,evalQuotedToken,evalToken,filters,isFalsy,isTruthy,tags,toPromise,toValue,toValueSync,version};
//# sourceMappingURL=/sm/5de7dfb12723a6582c5debe4274a53d11f4b34d20c2354ba6abf706b94cd578d.map